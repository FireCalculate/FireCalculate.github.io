<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv='Content-Type' content='text/html; charset=utf-8'/>
    <link rel="icon" href="dist/favicon/expense.ico"/>
    <title>æ¶ˆè´¹ç›˜ç‚¹</title>
    <!-- Bootstrap & jQueryï¼ˆä¸ç°é¡µä¸€è‡´çš„æŠ€æœ¯æ ˆï¼‰ -->
    <link rel="stylesheet" type="text/css" href="dist/css/c070423032508.css">
    <link rel="stylesheet" type="text/css" href="dist/css/c220423282110.css">
    <link rel="stylesheet" href="dist/css/bootstrap.min.css">
    <script src="dist/js/jquery-3.7.0.min.js"></script>
    <script src="dist/js/bootstrap.min.js"></script>
    <script src="dist/js/bootstrap.bundle.min.js"></script>

    <style>
        body {
            background: #fff;
            padding-bottom: 60px;
        }

        .page-title {
            font-weight: 700;
            letter-spacing: .5px;
        }

        .th-info {
            color: #6c757d;
            font-weight: 400;
            font-size: .85rem;
        }

        .card-soft {
            background: linear-gradient(180deg, #ffffff 0%, #f8f9fa 100%);
            border: 1px solid #e9ecef;
            border-radius: .75rem;
            box-shadow: 0 1px 2px rgba(0, 0, 0, .03);
        }

        .table thead th {
            white-space: nowrap;
            vertical-align: bottom;
            position: sticky;
            top: 0;
            z-index: 2;
            background: #212529;
            color: #fff;
            border-color: #212529;
        }

        .table td, .table th {
            vertical-align: middle;
        }

        .num {
            text-align: right;
            font-variant-numeric: tabular-nums;
        }

        .muted {
            color: #6c757d;
        }

        .tfoot-total td {
            font-weight: 800;
            font-size: 1.05rem;
            background: #fcfcfd;
            border-top: 2px solid #343a40;
        }

        .btn-black {
            background: #000;
            color: #fff;
        }

        .btn-black:hover {
            color: #fff;
            filter: brightness(1.1);
        }

        .tag {
            padding: .2rem .4rem;
            border-radius: .35rem;
            background: #f1f3f5;
            font-size: .8rem;
        }

        .table-responsive {
            width: 100%;
        }

        .table {
            width: 100%;
        }

        .bottom-navigation {
            z-index: 1000;
        }
    </style>
</head>
<body>
<div class="container-fluid py-4 px-3">
    <div class="d-flex align-items-center mb-3">
        <h2 class="page-title mb-0">æ¶ˆè´¹ç›˜ç‚¹</h2>
        <div class="ml-3 tag">æ—¥å‡ / æœˆå‡ / å¹´å‡ / 30å¹´ / <span id="yearsLabel">--</span>å¹´</div>
    </div>

    <!-- æ§ä»¶åŒº -->
    <div class="card-soft p-3 mb-3">
        <div class="d-flex flex-wrap align-items-center">
            <div class="mr-2 mb-2">
                <button id="addRow" class="btn btn-outline-secondary">ï¼‹ æ·»åŠ ä¸€è¡Œ</button>
            </div>
            <div class="mr-2 mb-2">
                <button id="restoreTemplate" class="btn btn-outline-secondary">â†º æ¢å¤ç¤ºä¾‹æ¨¡æ¿</button>
            </div>
            <div class="mr-2 mb-2">
                <button id="clearAll" class="btn btn-outline-secondary">ğŸ—‘ æ¸…ç©ºå…¨éƒ¨</button>
            </div>

            <!-- å¯¼å…¥/å¯¼å‡º -->
            <div class="mr-2 mb-2">
                <button id="importCSV" class="btn btn-outline-primary">â¤’ å¯¼å…¥ CSV</button>
                <input id="importFile" type="file" accept=".csv,text/csv" class="d-none"/>
            </div>
            <div class="mr-2 mb-2">
                <button id="exportCSV" class="btn btn-black">â¤“ å¯¼å‡º CSV</button>
            </div>
        </div>
    </div>

    <!-- è¡¨æ ¼ -->
    <div class="table-responsive">
        <table id="expenseTable" class="table table-hover table-bordered mb-0">
            <thead class="thead-dark">
            <tr>
                <th style="min-width:90px;">ç±»ç›®</th>
                <th style="min-width:180px;">é¡¹ç›®</th>
                <th style="min-width:100px;">å‘¨æœŸ</th>
                <th class="num">æ”¯å‡ºÂ¥</th>
                <th class="num">æ—¥å‡Â¥</th>
                <th class="num">æœˆå‡Â¥</th>
                <th class="num">å¹´å‡Â¥</th>
                <th class="num">30å¹´Â¥</th>
                <th class="num">
                    <div class="d-flex align-items-center justify-content-center">
                        <select id="yearsSelect" class="custom-select custom-select-sm w-auto"></select>
                        <span class="ml-1">Â¥</span>
                    </div>
                </th>
                <th class="text-center" style="min-width:90px;">æ“ä½œ</th>
            </tr>
            </thead>
            <tbody id="tbody"></tbody>
            <tfoot>
            <tr class="tfoot-total">
                <td colspan="3" class="text-right">åˆè®¡</td>
                <td class="num" id="sumD">0.00</td>
                <td class="num" id="sumE">0.00</td>
                <td class="num" id="sumF">0.00</td>
                <td class="num" id="sumG">0.00</td>
                <td class="num" id="sumH">0.00</td>
                <td class="num" id="sumI">0.00</td>
                <td></td>
            </tr>
            </tfoot>
        </table>
    </div>

    <div class="small text-muted mt-2">
        å‘¨æœŸå¤©æ•°æ˜ å°„ï¼šæ¯å¤©=1ï¼Œ æ¯å‘¨=7ï¼Œ æ¯æœˆ=30ï¼Œ æ¯å¹´=365ï¼Œ
        æ¯2å¹´=730...
    </div>
</div>

<div class="bottom-navigation">
    <a href="index.html">ğŸ’° FIREè®¡ç®—å™¨</a>
    <a href="life.html">â° ç”Ÿå‘½å€’è®¡æ—¶</a>
    <a href="expense.html">ğŸ§¾ æ¶ˆè´¹ç›˜ç‚¹</a>
    <!--<a href="clock.html">â° FIREæ—¶é’Ÿ</a>-->
    <a href="rental.html">ğŸ  æˆ¿äº§ç§Ÿå”®æ¯”</a>
</div>

<script>
    /* ===== é…ç½® ===== */
    // æ‰©å±•å‘¨æœŸå¯é€‰é¡¹ï¼šæ–°å¢ æ¯6å¹´~æ¯10å¹´
    const PERIOD_OPTIONS = [
        "æ¯å¤©", "æ¯å‘¨", "æ¯æœˆ", "æ¯å¹´",
        "æ¯2å¹´", "æ¯3å¹´", "æ¯4å¹´", "æ¯5å¹´",
        "æ¯6å¹´", "æ¯7å¹´", "æ¯8å¹´", "æ¯9å¹´", "æ¯10å¹´"
    ];
    const PERIOD_TO_DAYS = {
        "æ¯å¤©": 1, "æ¯å‘¨": 7, "æ¯æœˆ": 30, "æ¯å¹´": 365,
        "æ¯2å¹´": 2 * 365, "æ¯3å¹´": 3 * 365, "æ¯4å¹´": 4 * 365, "æ¯5å¹´": 5 * 365,
        "æ¯6å¹´": 6 * 365, "æ¯7å¹´": 7 * 365, "æ¯8å¹´": 8 * 365, "æ¯9å¹´": 9 * 365, "æ¯10å¹´": 10 * 365
    };
    const CATEGORY_OPTIONS = ["é¥®é£Ÿ", "å¨±ä¹", "ç”µå­", "ç”Ÿæ´»", "å®¶ç”µ", "äº¤é€š", "æ—…æ¸¸", "å…¶å®ƒ"];

    const YEARS_DEFAULT = 40;
    const LS_KEY = 'expense_rows_v1';
    const LS_YEARS_KEY = 'expense_years_v1';
    let selectedYears = YEARS_DEFAULT;

    /* ç¤ºä¾‹æ¨¡æ¿ï¼ˆä¿æŒä¸å˜ï¼Œå¯è‡ªç”±ç¼–è¾‘ï¼‰ */
    const TEMPLATE_ROWS = [
        {cat: "é¥®é£Ÿ", name: "æ—©é¤", period: "æ¯å¤©", amount: 3},
        {cat: "é¥®é£Ÿ", name: "ä¸­é¥­ï¼ˆè‡ªå·±åšï¼‰", period: "æ¯å¤©", amount: 15},
        {cat: "é¥®é£Ÿ", name: "æ™šé¥­ï¼ˆé¸¡è›‹+ç‰›å¥¶+ç‰ç±³ç­‰ï¼‰", period: "æ¯å¤©", amount: 7},
        {cat: "é¥®é£Ÿ", name: "æ°´æœ", period: "æ¯å¤©", amount: 6},
        {cat: "é¥®é£Ÿ", name: "åƒå¤§é¤ï¼ˆæ¯æœˆ2~3æ¬¡ï¼‰", period: "æ¯æœˆ", amount: 200},
        {cat: "å¨±ä¹", name: "ç”µå½±ç¥¨ï¼ˆæ¯æœˆ2~3å¼ ï¼‰", period: "æ¯æœˆ", amount: 200},
        {cat: "ç”µå­", name: "æ‰‹æœº", period: "æ¯3å¹´", amount: 3000},
        {cat: "ç”µå­", name: "ç”µè„‘ï¼ˆå«æ˜¾å¡ï¼‰", period: "æ¯4å¹´", amount: 8000},
        {cat: "ç”µå­", name: "å¤–è®¾ï¼ˆæ˜¾ç¤ºå™¨/éŸ³ç®±ï¼‰", period: "æ¯4å¹´", amount: 5000},
        {cat: "ç”Ÿæ´»", name: "è¯è´¹+ç½‘è´¹ï¼ˆç”µä¿¡1000Mï¼‰", period: "æ¯æœˆ", amount: 199},
        {cat: "ç”Ÿæ´»", name: "è¿åŠ¨å™¨æ¢°ï¼ˆæŸåé—²é±¼è´­å…¥2~3æ¬¡ï¼‰", period: "æ¯å¹´", amount: 1000},
        {cat: "ç”Ÿæ´»", name: "æ°´ç”µç‡ƒæ°”", period: "æ¯å¹´", amount: 3000},
        {cat: "ç”Ÿæ´»", name: "ç‰©ä¸šè´¹ï¼ˆå«å¢™ä½“ç®¡é“çš„æŸè€—ç»´æŠ¤è´¹ï¼‰", period: "æ¯å¹´", amount: 1500},
        {cat: "å®¶ç”µ", name: "å†°ç®±", period: "æ¯5å¹´", amount: 1500},
        {cat: "å®¶ç”µ", name: "æ´—è¡£æœº", period: "æ¯5å¹´", amount: 2000},
        {cat: "å®¶ç”µ", name: "çƒ˜å¹²æœº", period: "æ¯5å¹´", amount: 2000},
        {cat: "å®¶ç”µ", name: "ç©ºè°ƒ", period: "æ¯5å¹´", amount: 2000},
        {cat: "äº¤é€š", name: "äº¤é€šè´¹ï¼ˆå¸‚åŸŸåœ°é“ï¼‰", period: "æ¯æœˆ", amount: 40},
        {cat: "äº¤é€š", name: "äº¤é€šè´¹ï¼ˆåŸé™…é«˜é“ï¼‰", period: "æ¯å¹´", amount: 1000},
        {cat: "äº¤é€š", name: "äº¤é€šè´¹ï¼ˆå°ç”µé©´å«å……ç”µï¼‰", period: "æ¯3å¹´", amount: 3000},
        {cat: "æ—…æ¸¸", name: "", period: "æ¯å¹´", amount: 0},
        {cat: "å…¶å®ƒ", name: "è¡£ç‰©/æ—¥ç”¨/åŒ»ç–—/äººæƒ…/å­¦ä¹ â€¦", period: "æ¯å¹´", amount: 1000}
    ];

    /* ===== å·¥å…·å‡½æ•° ===== */
    const fmt = n => Number(n || 0).toLocaleString('zh-CN', {minimumFractionDigits: 2, maximumFractionDigits: 2});
    // æ–°å¢ï¼šç”¨äºâ€œåˆè®¡è¡Œâ€çš„çº¯æ•°å­—æ ¼å¼ï¼ˆå»æ‰åƒåˆ†ä½ï¼‰
    const fmtPlain = n => (Number(n || 0)).toFixed(2);

    const parseNum = v => isNaN(parseFloat(v)) ? 0 : parseFloat(v);

    function calcByDays(amount, days) {
        if (!days) return {E: 0, F: 0, G: 0, H: 0, I: 0};
        const E = amount / days;   // æ—¥å‡
        const F = E * 30;          // æœˆå‡
        const G = E * 365;         // å¹´å‡
        const H = G * 30;          // 30å¹´
        const I = G * selectedYears; // Nå¹´ï¼ˆä¸‹æ‹‰å¯é€‰ï¼‰
        return {E, F, G, H, I};
    }

    function buildSelect(options, selected) {
        const $sel = $('<select class="form-control form-control-sm"></select>');
        options.forEach(opt => {
            $sel.append(`<option ${opt === selected ? 'selected' : ''}>${opt}</option>`);
        });
        return $sel;
    }

    function buildRow(data = {cat: "å…¶å®ƒ", name: "", period: "æ¯æœˆ", amount: 0}) {
        const $tr = $('<tr></tr>');
        const $cat = buildSelect(CATEGORY_OPTIONS, data.cat).addClass('input-cat');
        const $name = $(`<input type="text" class="form-control form-control-sm input-name" placeholder="">`).val(data.name);
        const $period = buildSelect(PERIOD_OPTIONS, data.period).addClass('select-period');
        const $amount = $(`<input type="number" class="form-control form-control-sm input-amount num" step="0.01" min="0">`).val(data.amount);

        const $tdCat = $('<td></td>').append($cat);
        const $tdName = $('<td></td>').append($name);
        const $tdPer = $('<td></td>').append($period);
        const $tdAmt = $('<td class="num"></td>').append($amount);
        const $tdE = $('<td class="num cell-daily">0.00</td>');
        const $tdF = $('<td class="num cell-monthly">0.00</td>');
        const $tdG = $('<td class="num cell-yearly">0.00</td>');
        const $tdH = $('<td class="num cell-30y">0.00</td>');
        const $tdI = $('<td class="num cell-custom-y">0.00</td>');
        const $tdOps = $('<td class="text-center"></td>').append('<button class="btn btn-sm btn-outline-danger btn-del">åˆ é™¤</button>');

        $tr.append($tdCat, $tdName, $tdPer, $tdAmt, $tdE, $tdF, $tdG, $tdH, $tdI, $tdOps);

        // äº‹ä»¶
        $tr.on('input change', '.input-amount, .select-period, .input-name, .input-cat', () => {
            computeRow($tr);
            computeTotals();
            saveToLocalStorage();
        });
        $tr.on('click', '.btn-del', () => {
            $tr.remove();
            computeTotals();
            saveToLocalStorage();
        });

        computeRow($tr);
        return $tr;
    }

    function computeRow($tr) {
        const amount = parseNum($tr.find('.input-amount').val());
        const period = $tr.find('.select-period').val();
        const days = PERIOD_TO_DAYS[period] || 0;
        const {E, F, G, H, I} = calcByDays(amount, days);
        $tr.find('.cell-daily').text(fmt(E));
        $tr.find('.cell-monthly').text(fmt(F));
        $tr.find('.cell-yearly').text(fmt(G));
        $tr.find('.cell-30y').text(fmt(H));
        $tr.find('.cell-custom-y').text(fmt(I));
    }

    function computeTotals() {
        let sumD = 0, sumE = 0, sumF = 0, sumG = 0, sumH = 0, sumI = 0;
        $('#tbody tr').each(function () {
            const $tr = $(this);
            const amount = parseNum($tr.find('.input-amount').val());
            const e = parseNum($tr.find('.cell-daily').text().replace(/,/g, ''));
            const f = parseNum($tr.find('.cell-monthly').text().replace(/,/g, ''));
            const g = parseNum($tr.find('.cell-yearly').text().replace(/,/g, ''));
            const h = parseNum($tr.find('.cell-30y').text().replace(/,/g, ''));
            const i = parseNum($tr.find('.cell-custom-y').text().replace(/,/g, ''));
            sumD += amount;
            sumE += e;
            sumF += f;
            sumG += g;
            sumH += h;
            sumI += i;
        });
        // åˆè®¡è¡Œæ”¹ä¸ºâ€œåŸå§‹æ•°å­—â€ï¼ˆæ— åƒåˆ†ä½ï¼‰ï¼Œä¿ç•™ä¸¤ä½å°æ•°
        $('#sumD').text(fmtPlain(sumD));
        $('#sumE').text(fmtPlain(sumE));
        $('#sumF').text(fmtPlain(sumF));
        $('#sumG').text(fmtPlain(sumG));
        $('#sumH').text(fmtPlain(sumH));
        $('#sumI').text(fmtPlain(sumI));
    }

    function recomputeAll() {
        $('#tbody tr').each(function () {
            computeRow($(this));
        });
        computeTotals();
    }

    /* ===== LocalStorageï¼ˆè¡Œæ•°æ®ï¼‰ ===== */
    function saveToLocalStorage() {
        const rows = [];
        $('#tbody tr').each(function () {
            rows.push({
                cat: $(this).find('.input-cat').val(),
                name: $(this).find('.input-name').val(),
                period: $(this).find('.select-period').val(),
                amount: parseNum($(this).find('.input-amount').val())
            });
        });
        localStorage.setItem(LS_KEY, JSON.stringify(rows));
    }

    function loadFromLocalStorage() {
        try {
            const json = localStorage.getItem(LS_KEY);
            if (!json) return null;
            const rows = JSON.parse(json);
            if (!Array.isArray(rows)) return null;
            return rows;
        } catch (e) {
            return null;
        }
    }

    function clearLocal() {
        localStorage.removeItem(LS_KEY);
    }

    /* ===== LocalStorageï¼ˆå¹´æ•°ï¼‰ ===== */
    function saveYearsToLocalStorage() {
        localStorage.setItem(LS_YEARS_KEY, String(selectedYears));
    }

    function loadYearsFromLocalStorage() {
        const v = localStorage.getItem(LS_YEARS_KEY);
        if (!v) return YEARS_DEFAULT;
        const n = parseInt(v, 10);
        return (Number.isFinite(n) && n >= 1 && n <= 100) ? n : YEARS_DEFAULT;
    }

    /* ===== å¹´æ•°ä¸‹æ‹‰åˆå§‹åŒ– ===== */
    function initYearsSelect() {
        const $sel = $('#yearsSelect');
        $sel.empty();
        for (let i = 1; i <= 100; i++) $sel.append(`<option value="${i}">${i}</option>`);
        selectedYears = loadYearsFromLocalStorage();
        $sel.val(String(selectedYears));
        updateYearsUI();

        $sel.on('change', () => {
            selectedYears = parseInt($sel.val(), 10) || YEARS_DEFAULT;
            saveYearsToLocalStorage();
            updateYearsUI();
            recomputeAll();
        });
    }

    function updateYearsUI() {
        $('#yearsLabel').text(String(selectedYears));
    }

    /* ===== CSV å¯¼å…¥/å¯¼å‡º ===== */
    function parseCSVLine(line) {
        const out = [];
        let cur = '', inQuotes = false;
        for (let i = 0; i < line.length; i++) {
            const ch = line[i], next = line[i + 1];
            if (inQuotes) {
                if (ch === '"' && next === '"') {
                    cur += '"';
                    i++;
                } else if (ch === '"') {
                    inQuotes = false;
                } else {
                    cur += ch;
                }
            } else {
                if (ch === '"') {
                    inQuotes = true;
                } else if (ch === ',') {
                    out.push(cur);
                    cur = '';
                } else {
                    cur += ch;
                }
            }
        }
        out.push(cur);
        return out;
    }

    function exportCSV() {
        const header = ["ç±»ç›®", "é¡¹ç›®", "å‘¨æœŸ", "æ”¯å‡º(Â¥)", "æ—¥å‡(Â¥)", "æœˆå‡(Â¥)", "å¹´å‡(Â¥)", "30å¹´(Â¥)", `${selectedYears}å¹´(Â¥)`];
        const lines = [header.join(',')];
        $('#tbody tr').each(function () {
            const tds = $(this).find('td');
            const row = [
                $(tds[0]).find('select').val(),
                (($(tds[1]).find('input').val() || '').replace(/,/g, ' ')),
                $(tds[2]).find('select').val(),
                parseNum($(tds[3]).find('input').val()),
                $(tds[4]).text().replace(/,/g, ''),
                $(tds[5]).text().replace(/,/g, ''),
                $(tds[6]).text().replace(/,/g, ''),
                $(tds[7]).text().replace(/,/g, ''),
                $(tds[8]).text().replace(/,/g, '')
            ];
            lines.push(row.join(','));
        });
        const sum = ["åˆè®¡", "", "",
            $('#sumD').text().replace(/,/g, ''),
            $('#sumE').text().replace(/,/g, ''),
            $('#sumF').text().replace(/,/g, ''),
            $('#sumG').text().replace(/,/g, ''),
            $('#sumH').text().replace(/,/g, ''),
            $('#sumI').text().replace(/,/g, '')];
        lines.push(sum.join(','));

        const blob = new Blob(['\ufeff' + lines.join('\n')], {type: 'text/csv;charset=utf-8;'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'æ¶ˆè´¹ç›˜ç‚¹.csv';
        a.click();
        URL.revokeObjectURL(a.href);
    }

    function importCSVFromText(text) {
        if (!text) return;
        if (text.charCodeAt(0) === 0xFEFF) text = text.slice(1);
        const lines = text.split(/\r?\n/).filter(l => l.trim().length > 0);
        if (lines.length < 2) {
            alert('CSV å†…å®¹ä¸ºç©ºæˆ–æ ¼å¼ä¸æ­£ç¡®');
            return;
        }

        const header = parseCSVLine(lines[0]);
        let importedYears = selectedYears;
        const lastHeader = header[header.length - 1] || '';
        const yearsMatch = lastHeader.match(/(\d+)\s*å¹´/);
        if (yearsMatch) {
            const y = parseInt(yearsMatch[1], 10);
            if (Number.isFinite(y) && y >= 1 && y <= 100) importedYears = y;
        }
        if (header.length < 9) {
            alert('CSV åˆ—æ•°ä¸è¶³ï¼Œæ— æ³•å¯¼å…¥');
            return;
        }

        const rows = [];
        for (let i = 1; i < lines.length; i++) {
            const arr = parseCSVLine(lines[i]);
            if (!arr.length) continue;
            if ((arr[0] || '').trim() === 'åˆè®¡') break;

            const cat = (arr[0] || 'å…¶å®ƒ').trim() || 'å…¶å®ƒ';
            const name = (arr[1] || '').trim();
            const period = (arr[2] || 'æ¯æœˆ').trim();
            const amount = parseNum(arr[3]);

            rows.push({cat, name, period, amount});
        }
        if (!rows.length) {
            alert('æœªè§£æåˆ°æœ‰æ•ˆæ•°æ®è¡Œ');
            return;
        }

        selectedYears = importedYears;
        $('#yearsSelect').val(String(selectedYears));
        updateYearsUI();
        saveYearsToLocalStorage();

        mountRows(rows);
        saveToLocalStorage();
    }

    function bindImport() {
        const fileInput = document.getElementById('importFile');
        document.getElementById('importCSV').addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', () => {
            const file = fileInput.files && fileInput.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = e => {
                try {
                    importCSVFromText(String(e.target.result || ''));
                } catch (err) {
                    console.error(err);
                    alert('å¯¼å…¥å¤±è´¥ï¼šæ–‡ä»¶è§£æé”™è¯¯');
                } finally {
                    fileInput.value = '';
                }
            };
            reader.onerror = () => {
                alert('è¯»å–æ–‡ä»¶å¤±è´¥');
                fileInput.value = '';
            };
            reader.readAsText(file, 'utf-8');
        });
    }

    /* ===== åˆå§‹åŒ– ===== */
    function addRow(data) {
        $('#tbody').append(buildRow(data));
    }

    function mountRows(rows) {
        $('#tbody').empty();
        rows.forEach(r => addRow(r));
        computeTotals();
    }

    $(function () {
        // åˆå§‹åŒ–â€œå¹´æ•°â€é€‰æ‹© & å¯¼å…¥ç»‘å®š
        initYearsSelect();
        bindImport();

        // è½½å…¥æœ¬åœ°æˆ–æ¨¡æ¿
        const saved = loadFromLocalStorage();
        mountRows(saved && saved.length ? saved : TEMPLATE_ROWS);

        // ç»‘å®šæŒ‰é’®
        $('#addRow').on('click', () => {
            addRow({cat: "å…¶å®ƒ", name: "", period: "æ¯æœˆ", amount: 0});
            saveToLocalStorage();
        });
        $('#restoreTemplate').on('click', () => {
            mountRows(TEMPLATE_ROWS);
            clearLocal();
            saveToLocalStorage();
        });
        $('#clearAll').on('click', () => {
            $('#tbody').empty();
            computeTotals();
            clearLocal();
        });
        $('#exportCSV').on('click', exportCSV);
    });
</script>
</body>
</html>
